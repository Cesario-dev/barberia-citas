<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Calendario de {{ nombre }}</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        body {
            margin: 0;
            background-color: black;
            color: white;
        }
        td, th {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        .ocupado {
            background: black;
            color: white;
        }
        .disponible {
            background: #EFB810;
        }
        .bloqueado {
            background: #ccc;
            color: #555;
        }
        a {
            display: inline-block;
            margin-top: 4px;
            padding: 4px 8px;
            font-size: 0.85em;
            background: #333;
            color: white;
            border-radius: 4px;
            text-decoration: none;
        }
        a:hover {
            background: #555;
        }
    </style>
</head>
<body>

<h2>Calendario de {{ nombre }}</h2>
<a href="{{ url_for('admin_panel') }}" style="display:inline-block;margin-bottom:15px;padding:8px 12px;background:#007bff;color:white;text-decoration:none;border-radius:5px;">
    â¬… Volver al panel
</a>
{% if es_admin %}
    <form action="{{ url_for('liberar_citas', peluquero_id=peluquero_id) }}"
          method="post"
          style="margin: 20px 0;">
        <button type="submit" class="btn-liberar">
            Liberar todos los espacios (excepto fijos)
        </button>
    </form>
{% endif %}
<table>
    <thead>
        <tr>
            <th>Hora / DÃ­a</th>
            {% for dia in dias %}
                <th>{{ dia }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for hora in horas %}
        <tr>
            <td>{{ hora }}</td>
            {% for dia in dias %}
                {% if (dia, hora) in ocupados %}
                    <td class="ocupado">
                        <strong>{{ ocupados[(dia, hora)]['nombre'] }}</strong><br>
                        ðŸ“ž <a href="https://wa.me/57{{ ocupados[(dia, hora)]['telefono'] }}"
                              target="_blank"
                              style="color: #25D366; text-decoration: none;">
                              {{ ocupados[(dia, hora)]['telefono'] }}
                            </a>
                            <form action="{{ url_for('toggle_fijo', cita_id=ocupados[(dia, hora)]['id']) }}"
                                  method="post"
                                  style="display:inline;">
                                <button type="submit" class="btn-fijar">
                                    {% if ocupados[(dia, hora)]['fijo'] %}
                                        Desfijar
                                    {% else %}
                                        Fijar
                                    {% endif %}
                                </button>
                            </form>
                        {% if es_admin %}
                            <a href="{{ url_for('ver_calendario_admin', peluquero_id=peluquero_id, cancelar_dia=dia, cancelar_hora=hora) }}" class="btn-cancelar">Cancelar</a>
                        {% endif %}
                    </td>
                {% elif (dia, hora) in disponibles %}
                    <td class="disponible">
                        {% if es_admin %}
                            <a href="{{ url_for('ver_calendario_admin', peluquero_id=peluquero_id, bloquear_dia=dia, bloquear_hora=hora) }}">ðŸš« Bloquear</a>
                        {% else %}
                            Disponible
                        {% endif %}
                    </td>
                {% elif (dia, hora) in bloqueados %}
                    <td class="bloqueado">
                        {% if es_admin %}
                            <a href="{{ url_for('ver_calendario_admin', peluquero_id=peluquero_id, reactivar_dia=dia, reactivar_hora=hora) }}">âž• Reactivar</a>
                        {% else %}
                            Bloqueado
                        {% endif %}
                    </td>
                {% else %}
                    <td class="bloqueado">No disponible</td>
                {% endif %}
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>

</body>
</html>
